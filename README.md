# 부산슈퍼 카드결제 정산 대시보드

> 카드 결제 데이터를 분석하고, 매입-포스 매칭 검증 및 거래처별 정산을 자동화하는 웹 대시보드

![Node.js](https://img.shields.io/badge/Node.js-v20+-339933?logo=node.js&logoColor=white)
![License](https://img.shields.io/badge/License-MIT-blue)

## 주요 기능

### 데이터 분석
- **카드사별 수수료율 역산** - 실제 적용된 수수료율 자동 계산
- **매입-포스 매칭 검증** - 승인번호 기반 자동 매칭 및 누락 건 검출
- **거래처별 정산** - 할인 유형 분석 및 정산액 자동 계산

### 웹 대시보드
- 실시간 통계 카드 (매입/포스/매칭 건수, 총 수수료)
- 카드사별 수수료 분석 테이블
- 거래처별 정산 현황 (아코디언 UI)
- 10선협의회 필터, 기간 필터, 정렬 기능
- 엑셀 리포트 다운로드 (요약/상세)

## 빠른 시작

```bash
# 의존성 설치
npm install

# 서버 실행
node server.js
```

브라우저에서 http://localhost:3000 접속 → **분석 실행** 클릭

## 필요한 엑셀 파일

분석을 위해 아래 4개 파일이 필요합니다:

| 파일 | 설명 | 출처 |
|------|------|------|
| `여신_매입내역.xlsx` | 카드사별 매입 내역 | 여신금융협회 |
| `포스_카드결제내역.xlsx` | POS 카드결제 내역 | POS 시스템 |
| `부산슈퍼 상품목록.xlsx` | 상품-거래처 매핑 | 자체 관리 |
| `영수증별매출상세현황.xlsx` | 영수증별 품목 내역 | POS 시스템 |

## 스크린샷

### 메인 대시보드
```
┌─────────────────────────────────────────────────────────┐
│  📊 매입내역    📋 포스결제    ✅ 매칭성공    💰 총수수료  │
│    1,234건        1,250건       1,220건      1,234,567원  │
├─────────────────────────────────────────────────────────┤
│  카드사별 수수료 현황                                     │
│  ┌──────────┬──────┬────────────┬──────────┬─────────┐  │
│  │ 카드사   │ 건수 │ 총매입금액  │ 총수수료  │ 수수료율│  │
│  ├──────────┼──────┼────────────┼──────────┼─────────┤  │
│  │ KB카드   │  245 │ 12,345,000 │  283,935 │  2.30%  │  │
│  │ 신한카드 │  198 │  9,876,000 │  227,148 │  2.30%  │  │
│  └──────────┴──────┴────────────┴──────────┴─────────┘  │
├─────────────────────────────────────────────────────────┤
│  거래처별 정산 현황                                       │
│  ┌─────────────────────────────────────────────────────┐│
│  │ 1  한국바이오뷰티 [10선협의회]                       ││
│  │    품목 45건 · 카드 38 · 비카드 7                   ││
│  │    ████████████████░░░░ 84.4%                       ││
│  │                              정산예정: 1,234,567원  ││
│  └─────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────┘
```

## 할인 유형 분석

시스템은 자동으로 할인 유형을 분석하고 부담 주체를 결정합니다:

| 할인 유형 | 부담 주체 | 정산 방식 |
|-----------|-----------|-----------|
| 쿠폰할인 | 판매자 | 할인 전 금액으로 정산 |
| 서비스할인 | 거래처 | 정산액 0원 |
| 일반할인 (15~20%) | 거래처 | 할인 후 금액으로 정산 |
| 금액권할인 | 판매자 | 할인 전 금액으로 정산 |
| 1+1 할인 (50%) | 거래처 | 할인 후 금액으로 정산 |

## 카드사별 수수료율

| 카드사 | 신용카드 | 체크카드 | 정산일 |
|--------|----------|----------|--------|
| KB국민 | 2.3% | 1.5% | T+2 |
| 신한 | 2.3% | 1.5% | T+2 |
| 삼성 | 2.3% | 1.55% | T+2 |
| 현대 | 2.3% | 1.55% | T+2 |
| 롯데 | 2.3% | 1.5% | T+2 |
| BC | 2.3% | 1.35% | T+2 |
| 하나 | 2.3% | 1.51% | T+2 |
| 농협 | 2.3% | 1.45% | T+2 |
| 우리 | 2.3% | 1.52% | T+2 |
| 카카오페이 | 1.8% | 1.8% | T+2 |

## 프로젝트 구조

```
카드결제내역/
├── server.js           # Express 서버 (API + 정적 파일)
├── dashboard.html      # 웹 대시보드 UI
├── card_analyzer.js    # 핵심 분석 모듈
├── package.json
└── README.md
```

## API 엔드포인트

| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | `/api/analyze` | 전체 분석 실행 |

## 엑셀 내보내기

대시보드에서 두 가지 형식의 엑셀 리포트를 다운로드할 수 있습니다:

- **정산용 (3.5% 일괄)** - 모든 카드 수수료를 3.5%로 일괄 적용
- **실수수료율 적용** - 카드사별 실제 수수료율 적용

각 리포트에는 요약 시트와 상세 시트가 포함됩니다.

## 문제 해결

### 서버 실행 시 포트 충돌
```bash
Error: listen EADDRINUSE: address already in use :::3000
```
→ 다른 프로세스가 3000 포트를 사용 중입니다. 해당 프로세스를 종료하거나 `server.js`에서 포트를 변경하세요.

### 분석 실행 시 "파일을 찾을 수 없음"
→ 위에 명시된 4개의 엑셀 파일이 같은 폴더에 있어야 합니다.

### 매칭률이 낮음
→ 승인번호가 누락된 포스 내역이 있을 수 있습니다. 포스누락내역을 확인하세요.

## 라이선스

MIT License

---

Made with ☕ by 부산슈퍼 개발팀
